% clc
% clear all
A=[
0 0 1 0 0 0 0.0009 0 0;
0 0 0 0.9992 0 0 -0.0389 0 0;
0 0 -0.0302 -0.0056 -0.0003 585.1165 11.4448 -59.529 0;
0 0 0 -0.0707 267.7499 -0.0003 0 0 0;
0 0 0 -1.0000 -3.3607 2.2223 0 0 0;
0 0 -1 0 2.4483 -3.3607 0 0 0;
0 0 0.0579 0.0108 0.0049 0.0037 -21.9557 114.2 0;
0 0 0 0 0 0 -1 0 0;
0 0 0 0.0389 0 0 0.9992 0 0;
];
B=[
0 0 0;
0 0 0;
0 0 43.3635;
0 0 0;
0.2026 2.5878 0;
2.5878 -0.0663 0;
0 0 -83.1883;
0 0 -3.8500;
0 0 0;
];
% B=[
% 0 0 0 0 0 0 0 0 0;
% 0 0 0 0 0 0 0 0 0;
% 0 0 43.3635 0 0 0 0 0 0;
% 0 0 0 0 0 0 0 0 0;
% 0.2026 2.5878 0 0 0 0 0 0 0;
% 2.5878 -0.0663 0 0 0 0 0 0 0;
% 0 0 -83.1883 0 0 0 0 0 0;
% 0 0 -3.8500 0 0 0 0 0 0;
% 0 0 0 0 0 0 0 0 0;
% ];
E=[
0 0 0;
0 0 0;
-0.0001 0.1756 -0.0395;
0.0000 0.0003 0.0338;
0 0 0;
0 0 0;
-0.0002 -0.3396 0.6424;
0 0 0;
0 0 0;
];
% trim=[0.0389 0.0009 0 0 -0.0009 0.0049 0 0 0 -0.1746 0.0072 0.0054 0];
% syms b1 b2 b3 b4 b5 b6 a1 a2 a3
% a1=13
% a2=12
% a3=30
% b1=13
% b2=12
% b3=1
% b4=1
% b5=1
% b6=6
C1=[1 0 0 0 0 0 0 0 0;
    0 1 0 0 0 0 0 0 0;
    0 0 1 0 0 0 0 0 0;
    0 0 0 1 0 0 0 0 0;
    0 0 0 0 0 0 0 0 0;
    0 0 0 0 0 0 0 0 0;
    0 0 0 0 0 0 1 0 0;
    0 0 0 0 0 0 0 0 0;
    0 0 0 0 0 0 0 0 1;
];
Q=[  1     0     0     0     0     0     0     0     0;
     0     1     0     0     0     0     0     0     0;
     0     0     1     0     0     0     0     0     0;
     0     0     0     1     0     0     0     0     0;
     0     0     0     0     0     0     0     0     0;
     0     0     0     0     0     0     0     0     0;
     0     0     0     0     0     0     1     0     0;
     0     0     0     0     0     0     0     0     0;
     0     0     0     0     0     0     0     0     1;]
% Q=eye(9)
R=0.01
% P=are(A,B,Q)

% F=inv(R)*B'*P
[X1,K1,L1] = icare(A,[],Q'*Q,[],[],[],-B*B');
F=inv(R)*B'*X1
Abk=A-B*F
eigabk=eig(Abk)
Qe=0.001*eye(9);
Re=1;
% %for kalman
[X2,K2,L2] = icare(A,[],Qe'*Qe,[],[],[],-C1*C1');
% Pk=are(A,C1,Qe)
Ke=X2*C1'*inv(Re)
Ack=A-Ke*C1
eigack=eig(Ack)
x0=[0;-0.1;0;0;0;0;0;0;0.1;0;0;0;0;0;0;0;0;0]
% x0=[0 0 0;
%     -0.1 -0.1 -0.1;
%     0 0 0;
%     0 0 0;
%     0 0 0;
%     0 0 0;
%     0 0 0;
%     0 0 0;
%     0.1 0.1 0.1;
%     0 0 0;
%     0 0 0;
%     0 0 0;
%     0 0 0;
%     0 0 0;
%     0 0 0;
%     0 0 0;
%     0 0 0;
%     0 0 0;]
% x0=[0 0 0 0 0 0 0 0 0 ;
%     0 -0.1 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0  0.1;
%     0 0 0 0 0 0 0 0 0  ;
%     0 0 0 0 0 0 0 0 0  ;
%     0 0 0 0 0 0 0 0 0 ;
%     0 0 0 0 0 0 0 0 0   ;
%     0 0 0 0 0 0 0 0 0    ; 
%     0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0;
%     0 0 0 0 0 0 0 0 0]
% C1*inv(A-B*F)*B
GG=[-0.0094    0.0004   -0.0033;
   -0.0314   -0.9988   -0.0381;
   -0.0033   -0.0003    0.0094;
   ]
G=inv(GG)
% G=inv(C1*inv(A-B*F)*B)
Ac=[A-B*F B*F;zeros(1*9) A-Ke*C1]
% Bc=B*G
Bc=1.0e+03*[
         0         0         0;
         0         0         0;
   -1.4341   -0.0018    4.1023;
         0         0         0;
   -0.0082   -0.0026   -0.0134;
   -0.2451   -0.0000   -0.0861;
    2.7513    0.0035   -7.8699;
    0.1273    0.0002   -0.3642;
         0         0         0;
         0         0         0;
         0         0         0;
         0         0         0;
         0         0         0;
         0         0         0;
         0         0         0;
         0         0         0;
         0         0         0;
         0         0         0;]
Cc=[ 1     0     0     0     0     0     0     0     0  0     0     0     0     0     0     0     0     0;
     0     1     0     0     0     0     0     0     0 0     0     0     0     0     0     0     0     0;
     0     0     1     0     0     0     0     0     0 0     0     0     0     0     0     0     0     0;
     0     0     0     1     0     0     0     0     0 0     0     0     0     0     0     0     0     0;
     0     0     0     0     0     0     0     0     0 0     0     0     0     0     0     0     0     0;
     0     0     0     0     0     0     0     0     0 0     0     0     0     0     0     0     0     0;
     0     0     0     0     0     0     1     0     0 0     0     0     0     0     0     0     0     0;
     0     0     0     0     0     0     0     0     0 0     0     0     0     0     0     0     0     0;
     0     0     0     0     0     0     0     0     1 0     0     0     0     0     0     0     0     0;]
Vw=[E;E-Ke*[0;0;1;1;0;0;1;0;0]]
% Vw =[
%          0         0         0 0         0         0 0         0         0;
%          0         0         0 0         0         0 0         0         0;
%    -0.0001    0.1756   -0.0395 0         0         0 0         0         0;
%          0    0.0003    0.0338 0         0         0 0         0         0;
%          0         0         0 0         0         0 0         0         0;
%          0         0         0 0         0         0 0         0         0;
%    -0.0002   -0.3396    0.6424 0         0         0 0         0         0;
%          0         0         0 0         0         0 0         0         0;
%          0         0         0 0         0         0 0         0         0;
%    -0.1000   -0.1000   -0.1000 0         0         0 0         0         0;
%    -0.0000   -0.0000   -0.0000 0         0         0 0         0         0;
%    -0.0007    0.1750   -0.0401 0         0         0 0         0         0;
%     0.0009    0.0012    0.0347 0         0         0 0         0         0;
%    -0.0002   -0.0002   -0.0002 0         0         0 0         0         0;
%    -0.0999   -0.0999   -0.0999 0         0         0 0         0         0;
%    -0.0005   -0.3399    0.6421 0         0         0 0         0         0;
%    -0.0001   -0.0001   -0.0001 0         0         0 0         0         0;
%    -0.0000   -0.0000   -0.0000 0         0         0 0         0         0]
Rref=[0;0;0]%=[0 0 0; 0 0 0 ;0  0 0;0 0 0;0 0 0;0 0 0;0 0 0;0 0 0;0 0 0;0 0 0;0 0 0;0 0 0;0 0 0;0 0 0;0 0 0;0 0 0;0 0 0;0 0 0;]
% [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
%       0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
%       0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0;]