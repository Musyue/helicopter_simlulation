% clc
% clear all
A=[
0 0 1 0 0 0 0.0009 0 0;
0 0 0 0.9992 0 0 -0.0389 0 0;
0 0 -0.0302 -0.0056 -0.0003 585.1165 11.4448 -59.529 0;
0 0 0 -0.0707 267.7499 -0.0003 0 0 0;
0 0 0 -1.0000 -3.3607 2.2223 0 0 0;
0 0 -1 0 2.4483 -3.3607 0 0 0;
0 0 0.0579 0.0108 0.0049 0.0037 -21.9557 114.2 0;
0 0 0 0 0 0 -1 0 0;
0 0 0 0.0389 0 0 0.9992 0 0;
];
B=[
0 0 0;
0 0 0;
0 0 43.3635;
0 0 0;
0.2026 2.5878 0;
2.5878 -0.0663 0;
0 0 -83.1883;
0 0 -3.8500;
0 0 0;
];
% B=[
% 0 0 0 0 0 0 0 0 0;
% 0 0 0 0 0 0 0 0 0;
% 0 0 43.3635 0 0 0 0 0 0;
% 0 0 0 0 0 0 0 0 0;
% 0.2026 2.5878 0 0 0 0 0 0 0;
% 2.5878 -0.0663 0 0 0 0 0 0 0;
% 0 0 -83.1883 0 0 0 0 0 0;
% 0 0 -3.8500 0 0 0 0 0 0;
% 0 0 0 0 0 0 0 0 0;
% ];
E=[
0 0 0;
0 0 0;
-0.0001 0.1756 -0.0395;
0.0000 0.0003 0.0338;
0 0 0;
0 0 0;
-0.0002 -0.3396 0.6424;
0 0 0;
0 0 0;
];
% trim=[0.0389 0.0009 0 0 -0.0009 0.0049 0 0 0 -0.1746 0.0072 0.0054 0];
% syms b1 b2 b3 b4 b5 b6 a1 a2 a3
% a1=13
% a2=12
% a3=30
% b1=13
% b2=12
% b3=1
% b4=1
% b5=1
% b6=6
C1=[1 0 0 0 0 0 0 0 0;
    0 1 0 0 0 0 0 0 0;
    0 0 1 0 0 0 0 0 0;
    0 0 0 1 0 0 0 0 0;
    0 0 0 0 0 0 0 0 0;
    0 0 0 0 0 0 0 0 0;
    0 0 0 0 0 0 1 0 0;
    0 0 0 0 0 0 0 0 0;
    0 0 0 0 0 0 0 0 1;
];
Q=[  1     0     0     0     0     0     0     0     0;
     0     0.01     0     0     0     0     0     0     0;
     0     0     1     0     0     0     0     0     0;
     0     0     0     1     0     0     0     0     0;
     0     0     0     0     0     0     0     0     0;
     0     0     0     0     0     0     0     0     0;
     0     0     0     0     0     0     1     0     0;
     0     0     0     0     0     0     0     0     0;
     0     0     0     0     0     0     0     0     1;]
% Q=eye(9)
R=0.01
% P=are(A,B,Q)

% F=inv(R)*B'*P
[X1,K1,L1] = icare(A,[],Q'*Q,[],[],[],-B*B');
F=inv(R)*B'*X1
Abk=A-B*F
eigabk=eig(Abk)
Qe=0.1*eye(9);
Re=1;
% %for kalman
[X2,K2,L2] = icare(A,[],Qe'*Qe,[],[],[],-C1*C1');
% Pk=are(A,C1,Qe)
Ke=X2*C1'*inv(Re)
Ack=A-Ke*C1
eigack=eig(Ack)
x0=[0 0 0 0 0 0 0 0 0;0 -0.1 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0  0.1;0 0 0 0 0 0 0 0 0  ;      0 0 0 0 0 0 0 0 0  ;      0 0 0 0 0 0 0 0 0 ;0 0 0 0 0 0 0 0 0   ;      0 0 0 0 0 0 0 0 0    ;     0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0;0 0 0 0 0 0 0 0 0]
% C1*inv(A-B*F)*B
GG=[-0.0094    0.0004   -0.0033;
   -0.0314   -0.9988   -0.0381;
   -0.0033   -0.0003    0.0094;
   ]
G=inv(GG)
% G=inv(C1*inv(A-B*F)*B)
Ac=[A-B*F B*F;zeros(1*9) A-Ke*C1]
% Bc=B*G
Bc=1.0e+03*[
         0         0         0;
         0         0         0;
   -1.4341   -0.0018    4.1023;
         0         0         0;
   -0.0082   -0.0026   -0.0134;
   -0.2451   -0.0000   -0.0861;
    2.7513    0.0035   -7.8699;
    0.1273    0.0002   -0.3642;
         0         0         0;
         0         0         0;
         0         0         0;
         0         0         0;
         0         0         0;
         0         0         0;
         0         0         0;
         0         0         0;
         0         0         0;
         0         0         0;]
Cc=[ 1     0     0     0     0     0     0     0     0  0     0     0     0     0     0     0     0     0;
     0     1     0     0     0     0     0     0     0 0     0     0     0     0     0     0     0     0;
     0     0     1     0     0     0     0     0     0 0     0     0     0     0     0     0     0     0;
     0     0     0     1     0     0     0     0     0 0     0     0     0     0     0     0     0     0;
     0     0     0     0     0     0     0     0     0 0     0     0     0     0     0     0     0     0;
     0     0     0     0     0     0     0     0     0 0     0     0     0     0     0     0     0     0;
     0     0     0     0     0     0     1     0     0 0     0     0     0     0     0     0     0     0;
     0     0     0     0     0     0     0     0     0 0     0     0     0     0     0     0     0     0;
     0     0     0     0     0     0     0     0     1 0     0     0     0     0     0     0     0     0;]
% Vw=[E;E-Ke*[1;0;0;0;0;0;0;0;0]]
Vw =[
         0         0         0 0         0         0 0         0         0;
         0         0         0 0         0         0 0         0         0;
   -0.0001    0.1756   -0.0395 0         0         0 0         0         0;
         0    0.0003    0.0338 0         0         0 0         0         0;
         0         0         0 0         0         0 0         0         0;
         0         0         0 0         0         0 0         0         0;
   -0.0002   -0.3396    0.6424 0         0         0 0         0         0;
         0         0         0 0         0         0 0         0         0;
         0         0         0 0         0         0 0         0         0;
   -0.1000   -0.1000   -0.1000 0         0         0 0         0         0;
   -0.0000   -0.0000   -0.0000 0         0         0 0         0         0;
   -0.0007    0.1750   -0.0401 0         0         0 0         0         0;
    0.0009    0.0012    0.0347 0         0         0 0         0         0;
   -0.0002   -0.0002   -0.0002 0         0         0 0         0         0;
   -0.0999   -0.0999   -0.0999 0         0         0 0         0         0;
   -0.0005   -0.3399    0.6421 0         0         0 0         0         0;
   -0.0001   -0.0001   -0.0001 0         0         0 0         0         0;
   -0.0000   -0.0000   -0.0000 0         0         0 0         0         0]
% BB=[
% 0 0 0;
% 0 0 0;
% 0 0 43.3635;
% 0 0 0;
% 0.2026 2.5878 0;
% 2.5878 -0.0663 0;
% 0 0 -83.1883;
% 0 0 -3.8500;
% 0 0 0;
% ];
% FF=   1.0e+05 *[
% 
%    -0.0044    0.0186    0.0167    0.0142    0.2871    1.5859    0.0227   -0.0951    0.0039;
%    -0.0263   -0.0168   -0.0140    0.0120    1.1157    0.2463   -0.0005    0.0530    0.0422;
%     0.0677    0.0280    0.0198   -0.0136   -0.3042   -1.2644   -0.0330   -1.6602   -1.6139;]
% SYS=ss(A,BB,F,0)
% bode(SYS)
% C2=[0 0 0 0 0 0 0 0 0;
% 0 0 0 0 0 0 0 0 0;
% 0 0 0 0 0 0 0 0 0;
% b1 0 0 0 0 0 0 0 0;
% 0 b2 0 0 0 0 0 0 0;
% 0 0 b3 0 0 0 0 0 0;
% 0 0 0 b4 0 0 0 0 0;
% 0 0 0 0 0 0 b5 0 0;
% 0 0 0 0 0 0 0 0 b6;
% ]
% D2=[a1 0 0;
%     0 a2 0;
%     0 0 a3;
%     0 0 0;
%     0 0 0;
%     0 0 0;
%     0 0 0;
%     0 0 0;
%     0 0 0;
%     ]
% gms2_data=zeros(1,10^4);
% loopnum=30;
% count=1;
% for i=1:loopnum
%     for j=1:loopnum
%         for k=1:loopnum
%             for l=1:loopnum
%                 for m=1:loopnum
%                     for n=1:loopnum
%                         b1=i;
%                         b2=j;
%                         b3=k;
%                         b4=l;
%                         b5=m;
%                         b6=n;
%                         a1=i;
%                         a2=j;
%                         a3=k;
%                         C2=[0 0 0 0 0 0 0 0 0;
%                         0 0 0 0 0 0 0 0 0;
%                         0 0 0 0 0 0 0 0 0;
%                         b1 0 0 0 0 0 0 0 0;
%                         0 b2 0 0 0 0 0 0 0;
%                         0 0 b3 0 0 0 0 0 0;
%                         0 0 0 b4 0 0 0 0 0;
%                         0 0 0 0 0 0 b5 0 0;
%                         0 0 0 0 0 0 0 0 b6;
%                         ];
%                         D2=[a1 0 0;
%                             0 a2 0;
%                             0 0 a3;
%                             0 0 0;
%                             0 0 0;
%                             0 0 0;
%                             0 0 0;
%                             0 0 0;
%                             0 0 0;
%                             ];
%                         gms2 = gm8star(A,B,C2,D2,E);
%                        
%                         gms2_data(1,int32(count))=gms2;
%                         count=count+1;
% 
%                         
% %                       P = h8care(A,B,C2,D2,E,2)  
%                     end
%                 end
%             end
%         end
%     end
% end
% gms2
% count
% hold on;
% plot(gms2_data);

% gms2 = gm8star(A,B,C2,D2,E);
% F = h8state(A,B,C2,D2,E,0.065,[1])
% Gin=[1.0368 0.0604 0.0746;-0.0760 0.9970 0.0169;0.0002 0.0185 -0.2441];
% P=[1 0 0 0 0 0 0 0 0;
%    0 1 0 0 0 0 0 0 0;
%    0 0 1 0 0 0 0 0 0;
%    0 0 0 1 0 0 0 0 0;
%    0 0 0 0 0 0 1 0 0;
%    0 0 0 0 0 0 0 0 1;
%    0 0 0 0 1 0 0 0 0;
%    0 0 0 0 0 1 0 0 0;
%    0 0 0 0 0 0 0 1 0;
%     ]
% AA=P*A*inv(P)
% BB=inv(P)*B